"use strict";(()=>{var e={};e.id=8830,e.ids=[8830],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},52521:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>w,patchFetch:()=>f,requestAsyncStorage:()=>g,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var o={};t.r(o),t.d(o,{GET:()=>u});var a=t(49303),n=t(88716),s=t(60670),i=t(87070),p=t(75748),c=t(88349);let d=process.env.CRON_SECRET||"your-secret-token";async function u(e){try{if(e.headers.get("authorization")!==`Bearer ${d}`)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=await p._.miniApp.findMany({where:{status:{in:["approved","auto_updated"]}},select:{id:!0,url:!0,farcasterJson:!0,name:!0}}),t=0,o=[];for(let e of r)try{let r=await (0,c.r)(e.url);if(!r)continue;let o="0x0CF70E448ac98689e326bd79075a96CcBcec1665",a={...r,owner:r.owner||r.owners||o,owners:r.owners||r.owner||o},n=e.farcasterJson?JSON.parse(e.farcasterJson):null,s=n?(0,c.g)(n):null,i=(0,c.g)(a);if(s!==i){let o=r.screenshots||[];await p._.miniApp.update({where:{id:e.id},data:{name:r.name||e.name,description:r.description||void 0,iconUrl:r.icon||void 0,category:r.category||void 0,screenshots:o,farcasterJson:JSON.stringify(a),lastUpdatedAt:new Date,autoUpdated:!0,status:"auto_updated"}}),t++}}catch(r){o.push(`App ${e.id} (${e.name}): ${r.message}`),console.error(`Error updating app ${e.id}:`,r)}return i.NextResponse.json({success:!0,updated:t,total:r.length,errors:o.length>0?o:void 0})}catch(e){return console.error("Cron update error:",e),i.NextResponse.json({error:"Failed to update apps",details:e.message},{status:500})}}let l=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/cron/update-apps/route",pathname:"/api/cron/update-apps",filename:"route",bundlePath:"app/api/cron/update-apps/route"},resolvedPagePath:"E:\\base\\store\\farcaster-base-hub\\src\\app\\api\\cron\\update-apps\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:h,serverHooks:m}=l,w="/api/cron/update-apps/route";function f(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},75748:(e,r,t)=>{t.d(r,{_:()=>a});var o=t(53524);let a=global.prisma??new o.PrismaClient({log:["error"]})},88349:(e,r,t)=>{async function o(e){try{let r=e.trim();r.startsWith("http")||(r=`https://${r}`),r=r.replace(/\/$/,"");let t=`${r}/.well-known/farcaster.json`,o=await fetch(t,{headers:{Accept:"application/json"},signal:AbortSignal.timeout(1e4)});if(!o.ok)return null;let a=await o.json(),n=a.icon;if(!n)try{let e=`${r}/.well-known/icon.png`;(await fetch(e,{method:"HEAD",signal:AbortSignal.timeout(5e3)})).ok&&(n=e)}catch(e){console.log("icon.png not found at /.well-known/icon.png")}return{name:a.name||void 0,icon:n||void 0,screenshots:Array.isArray(a.screenshots)?a.screenshots:void 0,category:a.category||void 0,description:a.description||void 0,url:a.url||r,ogImage:a.ogImage||a["og-image"]||a.og_image||void 0,developer:a.developer||void 0,owner:a.owner||a.owners||void 0,owners:a.owners||a.owner||void 0}}catch(e){return console.error("Error fetching farcaster.json:",e),null}}function a(e){let r=JSON.stringify(e),t=0;for(let e=0;e<r.length;e++)t=(t<<5)-t+r.charCodeAt(e),t&=t;return t.toString()}t.d(r,{g:()=>a,r:()=>o})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[9276,5972],()=>t(52521));module.exports=o})();