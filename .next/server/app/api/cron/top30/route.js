"use strict";(()=>{var e={};e.id=8482,e.ids=[8482],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},50985:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var a={};t.r(a),t.d(a,{GET:()=>u});var o=t(49303),n=t(88716),s=t(60670),i=t(87070),p=t(75748);let c=process.env.CRON_SECRET||"your-secret-token";async function u(e){try{if(e.headers.get("authorization")!==`Bearer ${c}`)return i.NextResponse.json({error:"Unauthorized"},{status:401});let r=await fetch("https://raw.githubusercontent.com/anshitraj/base-gpt-datafeed/main/miniapps.json",{headers:{Accept:"application/json"},next:{revalidate:1800}});if(!r.ok)throw Error(`Failed to fetch datafeed: ${r.statusText}`);let t=await r.json(),a=(Array.isArray(t)?t:t.apps||[]).map(e=>({...e,score:.4*(e.launches||0)+.3*(e.clicks||0)+.3*(e.trendingScore||0)}));a.sort((e,r)=>r.score-e.score);let o=a.slice(0,30),n=0,s=[];await p._.topBaseApps.deleteMany({});for(let e=0;e<o.length;e++){let r=o[e];try{await p._.topBaseApps.upsert({where:{url:r.url},create:{url:r.url,name:r.name,icon:r.icon||null,category:r.category||null,score:Math.round(r.score),rank:e+1,lastSynced:new Date},update:{name:r.name,icon:r.icon||null,category:r.category||null,score:Math.round(r.score),rank:e+1,lastSynced:new Date}});let t=await p._.miniApp.findUnique({where:{url:r.url}});t&&await p._.miniApp.update({where:{id:t.id},data:{topBaseRank:e+1}}),n++}catch(e){s.push(`App ${r.name} (${r.url}): ${e.message}`),console.error(`Error syncing app ${r.url}:`,e)}}return i.NextResponse.json({success:!0,synced:n,total:o.length,errors:s.length>0?s:void 0})}catch(e){return console.error("Top 30 sync error:",e),i.NextResponse.json({error:"Failed to sync Top 30",details:e.message},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/cron/top30/route",pathname:"/api/cron/top30",filename:"route",bundlePath:"app/api/cron/top30/route"},resolvedPagePath:"E:\\base\\store\\farcaster-base-hub\\src\\app\\api\\cron\\top30\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:m}=l,g="/api/cron/top30/route";function y(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},75748:(e,r,t)=>{t.d(r,{_:()=>o});var a=t(53524);let o=global.prisma??new a.PrismaClient({log:["error"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[9276,5972],()=>t(50985));module.exports=a})();