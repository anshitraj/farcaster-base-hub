"use strict";(()=>{var e={};e.id=5545,e.ids=[5545],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},77191:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>j,requestAsyncStorage:()=>f,routeModule:()=>x,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{POST:()=>m});var a=r(49303),o=r(88716),n=r(60670),i=r(87070),p=r(75748),l=r(90528),c=r(91585),u=r(26033);let d=c.Ry({jsonUrl:c.Z_().url("JSON URL must be valid"),developerWallet:c.Z_().regex(/^0x[a-fA-F0-9]{40}$/i,"Invalid wallet address")});async function m(e){try{let t;await (0,l.requireAdminOnly)();let r=await e.json(),s=d.parse(r);try{let e=await fetch(s.jsonUrl,{headers:{Accept:"application/json"},signal:AbortSignal.timeout(1e4)});if(!e.ok)return i.NextResponse.json({error:`Failed to fetch JSON from URL: ${e.status} ${e.statusText}`},{status:400});t=await e.json()}catch(e){return i.NextResponse.json({error:`Failed to fetch JSON: ${e.message}`},{status:400})}if(!t||"object"!=typeof t)return i.NextResponse.json({error:"Invalid JSON structure"},{status:400});let a="0x0CF70E448ac98689e326bd79075a96CcBcec1665",o={...t,owner:t.owner||t.owners||a,owners:t.owners||t.owner||a},n=t.url;if(!n)try{let e=new URL(s.jsonUrl);n=`${e.protocol}//${e.host}`}catch{return i.NextResponse.json({error:"Could not determine app URL from JSON or JSON URL"},{status:400})}try{new URL(n)}catch{return i.NextResponse.json({error:"Invalid app URL in metadata"},{status:400})}let c=t.icon;if(!c)try{let e=n.replace(/\/$/,""),t=`${e}/.well-known/icon.png`;(await fetch(t,{method:"HEAD",signal:AbortSignal.timeout(5e3)})).ok&&(c=t)}catch(e){console.log("icon.png not found at /.well-known/icon.png")}let u=await p._.developer.findUnique({where:{wallet:s.developerWallet.toLowerCase()}});u||(u=await p._.developer.create({data:{wallet:s.developerWallet.toLowerCase(),name:t.developer?.name||null}}));let m=await p._.miniApp.findUnique({where:{url:n}});if(m)return i.NextResponse.json({error:"App with this URL already exists",app:m},{status:400});let x=await p._.miniApp.create({data:{name:t.name||"Untitled App",description:t.description||"",url:n,iconUrl:c||"https://via.placeholder.com/512?text=App+Icon",category:t.category||"Utilities",developerTags:[],screenshots:Array.isArray(t.screenshots)?t.screenshots:[],farcasterJson:JSON.stringify(o),autoUpdated:!0,status:"approved",verified:!0,developerId:u.id,clicks:0,installs:0,launchCount:0,uniqueUsers:0,popularityScore:0,ratingAverage:0,ratingCount:0,baseMiniAppUrl:t.baseMiniAppUrl||t.deepLink?.base||null,farcasterUrl:t.farcasterUrl||t.deepLink?.farcaster||null},include:{developer:!0}});return i.NextResponse.json({success:!0,app:x,message:"App imported successfully from farcaster.json URL"})}catch(e){if("Admin access required"===e.message)return i.NextResponse.json({error:"Admin access required"},{status:403});if(e instanceof u.jm)return i.NextResponse.json({error:"Validation error",details:e.errors},{status:400});return console.error("JSON import error:",e),i.NextResponse.json({error:"Failed to import app from JSON URL",details:e.message},{status:500})}}let x=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/apps/import-json/route",pathname:"/api/admin/apps/import-json",filename:"route",bundlePath:"app/api/admin/apps/import-json/route"},resolvedPagePath:"E:\\base\\store\\farcaster-base-hub\\src\\app\\api\\admin\\apps\\import-json\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:h}=x,w="/api/admin/apps/import-json/route";function j(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9276,5972,1585,528],()=>r(77191));module.exports=s})();