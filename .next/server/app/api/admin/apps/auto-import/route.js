"use strict";(()=>{var e={};e.id=612,e.ids=[612],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},14099:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>w,serverHooks:()=>v,staticGenerationAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{POST:()=>g});var n=r(49303),a=r(88716),s=r(60670),i=r(87070),l=r(75748),p=r(90528),c=r(88349),u=r(91585),d=r(26033);let m=u.Ry({url:u.Z_().url("URL must be valid"),developerWallet:u.Z_().regex(/^0x[a-fA-F0-9]{40}$/,"Invalid wallet address")});async function g(e){try{await (0,p.requireAdminOnly)();let t=await e.json(),r=m.parse(t),o=await (0,c.r)(r.url);if(!o)return i.NextResponse.json({error:"Could not fetch farcaster.json from the provided URL"},{status:400});let n="0x0CF70E448ac98689e326bd79075a96CcBcec1665",a={...o,owner:o.owner||o.owners||n,owners:o.owners||o.owner||n},s=await l._.developer.findUnique({where:{wallet:r.developerWallet.toLowerCase()}});s||(s=await l._.developer.create({data:{wallet:r.developerWallet.toLowerCase(),name:o.developer?.name||null}}));let u=await l._.miniApp.findUnique({where:{url:r.url}});if(u)return i.NextResponse.json({error:"App with this URL already exists",app:u},{status:400});let d=o.icon;if(!d)try{let e=r.url.replace(/\/$/,""),t=`${e}/.well-known/icon.png`;(await fetch(t,{method:"HEAD",signal:AbortSignal.timeout(5e3)})).ok&&(d=t)}catch(e){console.log("icon.png not found at /.well-known/icon.png")}let g=await l._.miniApp.create({data:{name:o.name||"Untitled App",description:o.description||"",url:r.url,iconUrl:d||"https://via.placeholder.com/512?text=App+Icon",category:o.category||"Utilities",developerTags:[],screenshots:o.screenshots||[],farcasterJson:JSON.stringify(a),autoUpdated:!0,status:"approved",verified:!0,developerId:s.id,clicks:0,installs:0,launchCount:0,uniqueUsers:0,popularityScore:0,ratingAverage:0,ratingCount:0},include:{developer:!0}});return i.NextResponse.json({success:!0,app:g,message:"App auto-imported successfully from farcaster.json"})}catch(e){if("Admin access required"===e.message)return i.NextResponse.json({error:"Admin access required"},{status:403});if(e instanceof d.jm)return i.NextResponse.json({error:"Validation error",details:e.errors},{status:400});return console.error("Auto-import error:",e),i.NextResponse.json({error:"Failed to auto-import app",details:e.message},{status:500})}}let w=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/admin/apps/auto-import/route",pathname:"/api/admin/apps/auto-import",filename:"route",bundlePath:"app/api/admin/apps/auto-import/route"},resolvedPagePath:"E:\\base\\store\\farcaster-base-hub\\src\\app\\api\\admin\\apps\\auto-import\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:f,serverHooks:v}=w,x="/api/admin/apps/auto-import/route";function y(){return(0,s.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:f})}},88349:(e,t,r)=>{async function o(e){try{let t=e.trim();t.startsWith("http")||(t=`https://${t}`),t=t.replace(/\/$/,"");let r=`${t}/.well-known/farcaster.json`,o=await fetch(r,{headers:{Accept:"application/json"},signal:AbortSignal.timeout(1e4)});if(!o.ok)return null;let n=await o.json(),a=n.icon;if(!a)try{let e=`${t}/.well-known/icon.png`;(await fetch(e,{method:"HEAD",signal:AbortSignal.timeout(5e3)})).ok&&(a=e)}catch(e){console.log("icon.png not found at /.well-known/icon.png")}return{name:n.name||void 0,icon:a||void 0,screenshots:Array.isArray(n.screenshots)?n.screenshots:void 0,category:n.category||void 0,description:n.description||void 0,url:n.url||t,ogImage:n.ogImage||n["og-image"]||n.og_image||void 0,developer:n.developer||void 0,owner:n.owner||n.owners||void 0,owners:n.owners||n.owner||void 0}}catch(e){return console.error("Error fetching farcaster.json:",e),null}}function n(e){let t=JSON.stringify(e),r=0;for(let e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r&=r;return r.toString()}r.d(t,{g:()=>n,r:()=>o})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[9276,5972,1585,528],()=>r(14099));module.exports=o})();