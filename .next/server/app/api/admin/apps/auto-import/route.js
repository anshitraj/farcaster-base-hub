"use strict";(()=>{var e={};e.id=612,e.ids=[612],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},14099:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>v,patchFetch:()=>A,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>w,staticGenerationAsyncStorage:()=>y});var o={};t.r(o),t.d(o,{POST:()=>g});var a=t(49303),i=t(88716),s=t(60670),n=t(87070),l=t(75748),p=t(90528),c=t(88349),u=t(91585),d=t(26033);let m=u.Ry({url:u.Z_().url("URL must be valid")});async function g(e){try{await (0,p.requireAdminOnly)();let r=await e.json(),t=m.parse(r),o=await (0,c.r)(t.url);if(!o)return n.NextResponse.json({error:"Could not fetch farcaster.json from the provided URL"},{status:400});let a="0x0CF70E448ac98689e326bd79075a96CcBcec1665",i={...o,owner:o.owner||o.owners||a,owners:o.owners||o.owner||a},s=Array.isArray(o.owner)?o.owner[0]:"string"==typeof o.owner?o.owner:a,u=await l._.developer.findUnique({where:{wallet:s.toLowerCase()}});u||(u=await l._.developer.create({data:{wallet:s.toLowerCase(),name:o.developer?.name||"Unknown",verified:!0}}));let d=t.url.replace(/\/$/,""),g=o.homeUrl||o.url||d,h=await l._.miniApp.findUnique({where:{url:g}});if(h)return n.NextResponse.json({error:"App with this URL already exists",app:h},{status:400});let f=o.iconUrl||o.icon;f||(f="https://via.placeholder.com/512?text=App+Icon");let y=o.name||"Untitled App",w=o.description||o.subtitle||"",v=o.category||o.primaryCategory||"Utilities",A=o.tags||[],U=o.screenshotUrls||o.screenshots||[],x=o.ogImage||null,j=o.frameUrl||null,b=j?.includes("/fc-webhook")||j?.includes("/webhook")||j?.includes("/frame"),q=await l._.miniApp.create({data:{name:y,description:w||`${y} - A Farcaster mini app`,url:g,iconUrl:f,headerImageUrl:x,category:v,tags:Array.isArray(A)?A.slice(0,10):[],developerTags:[],screenshots:Array.isArray(U)?U.slice(0,5):[],baseMiniAppUrl:j&&!b?j:null,farcasterUrl:d,farcasterJson:JSON.stringify(i),autoUpdated:!0,status:"approved",verified:!0,developerId:u.id,clicks:0,installs:0,launchCount:0,uniqueUsers:0,popularityScore:0,ratingAverage:0,ratingCount:0},include:{developer:!0}});return n.NextResponse.json({success:!0,app:q,message:"App auto-imported successfully from farcaster.json"})}catch(e){if("Admin access required"===e.message)return n.NextResponse.json({error:"Admin access required"},{status:403});if(e instanceof d.jm)return n.NextResponse.json({error:"Validation error",details:e.errors},{status:400});return console.error("Auto-import error:",e),n.NextResponse.json({error:"Failed to auto-import app",details:e.message},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/apps/auto-import/route",pathname:"/api/admin/apps/auto-import",filename:"route",bundlePath:"app/api/admin/apps/auto-import/route"},resolvedPagePath:"E:\\base\\store\\farcaster-base-hub\\src\\app\\api\\admin\\apps\\auto-import\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:w}=h,v="/api/admin/apps/auto-import/route";function A(){return(0,s.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:y})}},88349:(e,r,t)=>{async function o(e){try{let r=e.trim();r.startsWith("http")||(r=`https://${r}`),r=r.replace(/\/$/,"");let t=`${r}/.well-known/farcaster.json`,o=await fetch(t,{headers:{Accept:"application/json"},signal:AbortSignal.timeout(1e4)});if(!o.ok)return null;let a=await o.json(),i=a.frame||a.miniapp||a,s=i.iconUrl||i.icon||a.icon||null;if(s){if(s.startsWith("/"))s=new URL(r).origin+s;else if(!s.startsWith("http")){let e=new URL(r).origin;s=`${e}/${s}`}}if(!s)try{let e=`${r}/icon.png`;(await fetch(e,{method:"HEAD",signal:AbortSignal.timeout(5e3)})).ok&&(s=e)}catch(e){console.log("icon.png not found at /icon.png")}let n=i.homeUrl||a.url||r,l=i.name||a.name,p=i.description||a.description,c=i.subtitle||a.subtitle,u=i.tags||a.tags||[],d=i.primaryCategory||a.category||a.primaryCategory,m=i.screenshotUrls||a.screenshots||[],g=i.webhookUrl||i.frameUrl||a.frameUrl,h=i.heroImageUrl||i.imageUrl||a.ogImage||a["og-image"]||a.og_image;if(Array.isArray(m)&&m.length>0){let e=new URL(r).origin;m=m.map(r=>r?r.startsWith("/")?e+r:r.startsWith("http")?r:`${e}/${r}`:r).filter(Boolean)}return{name:l,icon:s||void 0,iconUrl:s||void 0,screenshots:Array.isArray(m)?m:void 0,screenshotUrls:Array.isArray(m)?m:void 0,category:d||void 0,primaryCategory:d||void 0,description:p||void 0,subtitle:c||void 0,url:n||r,homeUrl:n||r,frameUrl:g||void 0,ogImage:h||void 0,tags:Array.isArray(u)?u:void 0,developer:a.developer||void 0,owner:a.owner||a.owners||void 0,owners:a.owners||a.owner||void 0,frame:i||void 0}}catch(e){return console.error("Error fetching farcaster.json:",e),null}}function a(e){let r=JSON.stringify(e),t=0;for(let e=0;e<r.length;e++)t=(t<<5)-t+r.charCodeAt(e),t&=t;return t.toString()}t.d(r,{g:()=>a,r:()=>o})}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[9276,5972,1585,528],()=>t(14099));module.exports=o})();