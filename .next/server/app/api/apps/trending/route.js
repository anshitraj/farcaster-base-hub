"use strict";(()=>{var e={};e.id=3228,e.ids=[3228],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},24679:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>h,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>f,staticGenerationAsyncStorage:()=>g});var a={};r.r(a),r.d(a,{GET:()=>l});var n=r(49303),p=r(88716),i=r(60670),s=r(87070),o=r(75748),d=r(32831);async function l(){try{let e;let t=await o._.miniApp.findMany({where:{status:"approved"},include:{events:!0,developer:{select:{id:!0,wallet:!0,name:!0,avatar:!0,verified:!0}}},orderBy:[{featuredInBanner:"desc"},{createdAt:"desc"}],take:20});if(0===t.length)return s.NextResponse.json({apps:[]});t.filter(e=>e.featuredInBanner),t.filter(e=>!e.featuredInBanner);let r=t.map(e=>({app:e,score:(0,d.c)(e)})).sort((e,t)=>e.app.featuredInBanner&&!t.app.featuredInBanner?-1:!e.app.featuredInBanner&&t.app.featuredInBanner?1:t.score-e.score);if(r.length<=10)e=r;else{let t=r.filter(({app:e})=>e.featuredInBanner),a=r.filter(({app:e})=>!e.featuredInBanner);e=[...t,...a].slice(0,10)}let a=e.map(({app:e})=>({...e,topBaseRank:e.topBaseRank,autoUpdated:e.autoUpdated,contractVerified:e.contractVerified,developerTags:e.developerTags||[],tags:e.tags||[],headerImageUrl:e.headerImageUrl}));return s.NextResponse.json({apps:a})}catch(e){return console.error("Get trending apps error:",e),s.NextResponse.json({apps:[]})}}let u=new n.AppRouteRouteModule({definition:{kind:p.x.APP_ROUTE,page:"/api/apps/trending/route",pathname:"/api/apps/trending",filename:"route",bundlePath:"app/api/apps/trending/route"},resolvedPagePath:"E:\\base\\store\\farcaster-base-hub\\src\\app\\api\\apps\\trending\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:g,serverHooks:f}=u,m="/api/apps/trending/route";function h(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:g})}},75748:(e,t,r)=>{r.d(t,{_:()=>n});var a=r(53524);let n=global.prisma??new a.PrismaClient({log:["error"]})},32831:(e,t,r)=>{r.d(t,{c:()=>a});function a(e){let t=Date.now(),r=e.events.filter(e=>t-e.createdAt.getTime()<=1728e5),a=r.filter(e=>"click"===e.type).length,n=.5*a+.3*r.filter(e=>"install"===e.type).length+.2*r.filter(e=>"open"===e.type).length;return n+=2*e.ratingAverage+Math.min(1.5*e.ratingCount,50),t-e.createdAt.getTime()<6048e5&&(n*=1.2),n}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[9276,5972],()=>r(24679));module.exports=a})();