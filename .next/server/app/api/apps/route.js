"use strict";(()=>{var e={};e.id=6558,e.ids=[6558],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},62423:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>y,patchFetch:()=>m,requestAsyncStorage:()=>u,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var s={};a.r(s),a.d(s,{GET:()=>l});var r=a(49303),n=a(88716),i=a(60670),d=a(87070),o=a(75748),p=a(32831);async function l(e){let t=e.nextUrl.searchParams,a=t.get("search")||"",s=t.get("category")||void 0,r=t.get("tag")||void 0,n=t.get("sort")||"newest",i=t.get("limit")||"20",l=t.get("offset")||"0",c=parseInt(i,10)||20,u=parseInt(l,10)||0;try{let e={status:"approved"};if(a){let t=a.toLowerCase();e.OR=[{name:{contains:a,mode:"insensitive"}},{description:{contains:a,mode:"insensitive"}},{category:{contains:a,mode:"insensitive"}},{tags:{has:t}}]}s&&("DeFi"===s?e.OR=[{category:"Finance"},{tags:{has:"defi"}}]:e.category=s),r&&(e.tags={has:r});let t={createdAt:"desc"},i=!1,l=!1;"trending"===n?(l=!0,t={clicks:"desc"}):"installs"===n?t={installs:"desc"}:"rating"===n?t={ratingAverage:"desc"}:"newest"===n&&(i=!0,t={createdAt:"desc"});let g={developer:{select:{id:!0,wallet:!0,name:!0,avatar:!0,verified:!0}}};l&&(g.events=!0);let h=await o._.miniApp.findMany({where:e,orderBy:t,take:i?Math.min(3*c,100):l?Math.min(2*c,50):c,skip:u,include:g});if(i&&"newest"===n){let e=Date.now(),t={"0-1day":[],"1-3days":[],"3-7days":[],"7+days":[]};h.forEach(a=>{let s=e-a.createdAt.getTime();s<864e5?t["0-1day"].push(a):s<2592e5?t["1-3days"].push(a):s<6048e5?t["3-7days"].push(a):t["7+days"].push(a)});let a=e=>{let t=[...e];for(let e=t.length-1;e>0;e--){let a=Math.floor(Math.random()*(e+1));[t[e],t[a]]=[t[a],t[e]]}return t},s=[],r=Math.max(t["0-1day"].length,t["1-3days"].length,t["3-7days"].length,t["7+days"].length),n={"0-1day":a(t["0-1day"]),"1-3days":a(t["1-3days"]),"3-7days":a(t["3-7days"]),"7+days":a(t["7+days"])};for(let e=0;e<r&&s.length<c&&(n["0-1day"][e]&&s.push(n["0-1day"][e]),!(s.length>=c))&&(n["1-3days"][e]&&s.push(n["1-3days"][e]),!(s.length>=c)&&(n["3-7days"][e]&&s.push(n["3-7days"][e]),!(s.length>=c))&&(n["7+days"][e]&&s.push(n["7+days"][e]),!(s.length>=c)));e++);for(let e of[...n["0-1day"].slice(r),...n["1-3days"].slice(r),...n["3-7days"].slice(r),...n["7+days"].slice(r)]){if(s.length>=c)break;s.find(t=>t.id===e.id)||s.push(e)}h=s.slice(0,c)}if(l&&"trending"===n){let e=h.map(e=>({app:{...e,events:e.events||[]},score:(0,p.c)({...e,events:e.events||[]})}));e.sort((e,t)=>t.score-e.score),h=e.slice(0,c).map(({app:e})=>e)}let y=await o._.miniApp.count({where:e});return d.NextResponse.json({apps:h.map(e=>({...e,topBaseRank:e.topBaseRank,autoUpdated:e.autoUpdated,contractVerified:e.contractVerified,developerTags:e.developerTags||[]})),total:y,limit:c,offset:u})}catch(e){return console.error("Get apps error:",e),d.NextResponse.json({apps:[],total:0,limit:c,offset:u},{status:200})}}let c=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/apps/route",pathname:"/api/apps",filename:"route",bundlePath:"app/api/apps/route"},resolvedPagePath:"E:\\base\\store\\farcaster-base-hub\\src\\app\\api\\apps\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:u,staticGenerationAsyncStorage:g,serverHooks:h}=c,y="/api/apps/route";function m(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},75748:(e,t,a)=>{a.d(t,{_:()=>r});var s=a(53524);let r=global.prisma??new s.PrismaClient({log:["error"]})},32831:(e,t,a)=>{a.d(t,{c:()=>s});function s(e){let t=Date.now(),a=e.events.filter(e=>t-e.createdAt.getTime()<=1728e5),s=a.filter(e=>"click"===e.type).length,r=.5*s+.3*a.filter(e=>"install"===e.type).length+.2*a.filter(e=>"open"===e.type).length;return r+=2*e.ratingAverage+Math.min(1.5*e.ratingCount,50),t-e.createdAt.getTime()<6048e5&&(r*=1.2),r}}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[9276,5972],()=>a(62423));module.exports=s})();